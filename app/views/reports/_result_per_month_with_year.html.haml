- if load_css
	= wicked_pdf_stylesheet_link_tag "print.css"
	= wicked_pdf_javascript_include_tag "application"
	%meta{http_equiv: "Content-Type", content: "text/html; charset=UTF-8" }
	.row.common-title
		.col-md-12
			%h1
				%span
					Reporte mensual
				= wicked_pdf_image_tag "statistic.png"
	#new_logo.row
		= wicked_pdf_image_tag "long_logo.png"
.row
	.col-md-2.col-md-offset-9
		= form_tag result_per_month_with_year_path(format: "pdf"), class: "download_pdf" do
			= hidden_field_tag "restaurant_id", result[6][:restaurant]
			= hidden_field_tag "month", result[6][:month]
			= hidden_field_tag "year", result[6][:year]
			= submit_tag "Descargar reporte en pdf", class: "btn btn-default submit_pdf_button"
- if result[0]
	- days = []
	- yes_total = 0
	- no_total = 0
	- yes = []
	- no = []
	- result[1].times do |i|
		- days << result[2][i]
		- yes << result[3][result[2][i].to_s][:yes]
		- yes_total += result[3][result[2][i].to_s][:yes]
		- no << result[3][result[2][i].to_s][:no]
		- no_total += result[3][result[2][i].to_s][:no]
	.station.row.result_to_care
		.col-md-12.col-xs-12.data-charts-container
			.total.col-md-4
				%h5
					= "Local: #{result[5][:restaurant].name}"
			.yes.col-md-2
				%h5
					= "Mes: #{result[4].strftime('%B')} "
			.no.col-md-2
				%h5
					= "Año: 2014"
			#data-with-charts.value-to-show.col-md-12
				.col-md-6.col-md-offset-2.line-graph-container
					.col-md-12
						%canvas#my_graph{ width: "400", height: "400",data: {days: "#{days}", yes: "#{yes}", no: "#{no}"}}
				.col-md-2.pie-graph-container
					%h3
						Satisfacción total
					#yes-pie.pie
						- my_yes_value = (yes_total*100)/(yes_total + no_total)
						.pie-data
							- if load_css
								= wicked_pdf_image_tag "person_red.png"
							- else
								= image_tag "person_red.png"
							%span.pie-label
								SI: #{my_yes_value}%
						#yes-pie-draw{data: {percent: "#{my_yes_value}"}}
							%canvas#yes_pie{ width: "100", height: "100" }
					#no-pie.pie
						- my_no_value = (no_total*100)/(yes_total + no_total)
						.pie-data
							- if load_css
								= wicked_pdf_image_tag "person_blue.png"
							- else
								= image_tag "person_blue.png"
							%span.pie-label
								NO: #{my_no_value}%
						#no-pie-draw{data: {percent: "#{my_no_value}"}}
							%canvas#no_pie{ width: "100", height: "100" }
	:javascript
		var donut_params = {
			segmentShowStroke: false,
			percentageInnerCutout: 50,
			animation: true,
			animationSteps: 100,
			animationEasing : "easeOutBounce",
			animateRotate : true,
			animateScale : false,
		};
		var no_donut = [
			{
				value : 100 - $("#no-pie-draw").data("percent"),
				color:"#CEA4A8"
			},
			{
				value : $("#no-pie-draw").data("percent"),
				color : "#FF0000"
			}
		];
		var yes_donut = [
			{
				value : 100 - $("#yes-pie-draw").data("percent"),
				color:"#2A295C"
			},
			{
				value : $("#yes-pie-draw").data("percent"),
				color : "#A19FAC"
			}
		];
		var lineChartData = {
			labels : $("#my_graph").data("days"),
			datasets : [
			{
				fillColor : "rgba(0,0,0,0)",
				strokeColor : "rgba(255,0,0,1)",
				pointColor : "rgba(255,0,0,1)",
				pointStrokeColor : "#ff0000",
				scaleLineColor : "rgba(255,0,0,1)",
				data : $("#my_graph").data("yes")
			},
			{
				fillColor : "rgba(0,0,0,0)",
				strokeColor : "rgba(42,41,92,1)",
				pointColor : "rgba(42,41,92,1)",
				pointStrokeColor : "#2A295C",
				data : $("#my_graph").data("no")
			}
			]
		};
		var line_params = {
			bezierCurve: false
		};
		var myLine = new Chart($("#my_graph").get(0).getContext("2d")).Line(lineChartData, line_params);
		var myDoughnut = new Chart($("#yes_pie").get(0).getContext("2d")).Doughnut(no_donut, donut_params);
		var myOtherDoughnut = new Chart($("#no_pie").get(0).getContext("2d")).Doughnut(yes_donut, donut_params);
- else
	%h1.no_survey_result
		No existe encuestas en la fecha indicada